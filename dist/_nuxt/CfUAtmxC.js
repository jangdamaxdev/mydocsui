import{Ca as e,Co as t,Ea as n,Ga as r,Ha as i,Ja as a,La as o,Ni as s,Qr as c,R as l,Ra as u,Sa as d,Ta as f,Xn as p,_a as m,cn as h,dn as g,ea as _,go as v,ka as y,lr as b,po as x,qa as S,qn as C,ro as w,so as T,to as E,wa as D,xa as O,xo as k,yo as A}from"#entry";import"./a8l3s_ZL.js";import{t as j}from"./B-vomAHf.js";import{t as M}from"./B4dG6Qjb.js";var N=[`data-status`],P=[`data-state`],F={__name:`UChatMessages`,props:{messages:{type:Array,required:!1},status:{type:null,required:!1},shouldAutoScroll:{type:Boolean,required:!1,default:!1},shouldScrollToBottom:{type:Boolean,required:!1,default:!0},autoScroll:{type:[Boolean,Object],required:!1,default:!0},autoScrollIcon:{type:String,required:!1},user:{type:Object,required:!1},assistant:{type:Object,required:!1},compact:{type:Boolean,required:!1},spacingOffset:{type:Number,required:!1,default:0},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(F){let I=F,ee=E(),L=h(ee,[`default`,`indicator`,`viewport`]),R=s(),z=v(()=>_(I.user,{side:`right`,variant:`soft`})),B=v(()=>_(I.assistant,{side:`left`,variant:`naked`})),V=O(()=>g({extend:g(j),...R.uiPro?.chatMessages||{}})({compact:I.compact})),H=x(null),U=x(null),W=x(new Map),G=x(!1),K=x(0),q=x(!1);function J(e,t){let n=t?.$el;n&&W.value.set(e,n)}function Y(e){let t=W.value.get(e);t&&t.scrollIntoView({behavior:`smooth`,block:`start`})}function X(e=!0){U.value&&(e?U.value.scrollTo({top:U.value.scrollHeight,behavior:`smooth`}):U.value.scrollTop=U.value.scrollHeight)}b([()=>I.messages,()=>I.status],([e,t])=>{t===`streaming`&&(I.shouldAutoScroll?requestAnimationFrame(()=>u(X)):Z())},{throttle:100,leading:!0}),w(()=>I.status,e=>{if(e!==`submitted`)return;let t=I.messages?.[I.messages.length-1];!t||t.role!==`user`||u(()=>{q.value=!0,$(),u(()=>{Y(t.id)})})});function Z(){if(!U.value)return;let e=U.value.scrollTop+U.value.clientHeight;G.value=U.value.scrollHeight-e>=100}function Q(){X()}function te(e){if(!e)return document.documentElement;let t=/auto|scroll/,n=e;for(;n&&n!==document.body&&n!==document.documentElement;){let e=window.getComputedStyle(n);if(t.test(e.overflowY))return n;n=n.parentElement}return document.documentElement}function $(){if(!H.value||!U.value||!I.messages?.length||!q.value)return;let{height:e}=C(U.value),t=I.messages.findLast(e=>e.role===`user`);if(!t)return;let n=W.value.get(t.id);if(!n)return;let r=I.spacingOffset||0,i=window.getComputedStyle(H.value),a=window.getComputedStyle(U.value);r+=Number.parseFloat(i.rowGap)||Number.parseFloat(i.gap)||0,r+=Number.parseFloat(a.paddingTop)||0,r+=Number.parseFloat(a.paddingBottom)||0,K.value=Math.max(e.value-n.offsetHeight-r,0)}return i(()=>{U.value=te(H.value),U.value&&(I.shouldScrollToBottom?u(()=>X(!1)):Z(),p(U,`scroll`,Z),p(window,`resize`,()=>u($)))}),(i,s)=>(r(),f(`div`,{ref_key:`el`,ref:H,"data-status":F.status,class:k(V.value.root({class:[I.ui?.root,I.class]})),style:t({"--last-message-height":`${K.value}px`})},[a(i.$slots,`default`,{},()=>[(r(!0),f(m,null,S(F.messages,t=>(r(),e(M,o({key:t.id},{ref_for:!0},{...t,...t.role===`user`?z.value:B.value},{ref_for:!0,ref:e=>J(t.id,e),compact:F.compact}),n({_:2},[S(A(L),(e,n)=>({name:n,fn:T(()=>[a(i.$slots,n,o({ref_for:!0},{message:t}))])}))]),1040,[`compact`]))),128))]),F.status===`submitted`?(r(),e(M,o({key:0,id:`indicator`,content:``,role:`assistant`},{...B.value,actions:void 0},{compact:F.compact}),{content:T(()=>[d(`div`,{class:k(V.value.indicator({class:I.ui?.indicator}))},[a(i.$slots,`indicator`,{},()=>[s[0]||=d(`span`,null,null,-1),s[1]||=d(`span`,null,null,-1),s[2]||=d(`span`,null,null,-1)])],2)]),_:3},16,[`compact`])):D(``,!0),y(A(c),{present:G.value},{default:T(()=>[d(`div`,{"data-state":G.value?`open`:`closed`,class:k(V.value.viewport({class:I.ui?.viewport}))},[a(i.$slots,`viewport`,{onClick:Q},()=>[F.autoScroll?(r(),e(l,o({key:0,icon:F.autoScrollIcon||A(R).ui.icons.arrowDown,color:`neutral`,variant:`outline`},typeof F.autoScroll==`object`?F.autoScroll:{},{class:V.value.autoScroll({class:I.ui?.autoScroll}),onClick:Q}),null,16,[`icon`,`class`])):D(``,!0)])],10,P)]),_:3},8,[`present`])],14,N))}};export{F as default};
//# sourceMappingURL=CfUAtmxC.js.map