import{$a as e,Ca as t,En as n,Fa as r,Fn as i,Ga as a,Ha as o,Ja as s,Ka as c,Ln as l,Ni as u,Pn as d,Ra as f,Rn as p,Ua as m,Xa as h,Yn as g,do as _,fo as v,ha as y,po as b,so as x,xa as S,xo as C,yo as w,zn as T}from"#entry";import{t as E}from"./BWpl7YOl.js";function D(e){return e.validate&&e.__isYupSchema__}function O(e){return e.inner!==void 0}function k(e){return`schema`in e&&typeof e.coercer==`function`&&typeof e.validator==`function`&&typeof e.refiner==`function`}function A(e){return e.validateAsync!==void 0&&e.id!==void 0}function j(e){return e.isJoi===!0}function M(e){return`~standard`in e}async function N(e,t){let n=await t[`~standard`].validate(e);return n.issues?{errors:n.issues?.map(e=>({name:e.path?.map(e=>typeof e==`object`?e.key:e).join(`.`)||``,message:e.message}))||[],result:null}:{errors:null,result:n.value}}async function P(e,t){try{return{errors:null,result:await t.validate(e,{abortEarly:!1})}}catch(e){if(O(e))return{errors:e.inner.map(e=>({name:e.path??``,message:e.message})),result:null};throw e}}async function F(e,t){let[n,r]=t.validate(e);return n?{errors:n.failures().map(e=>({message:e.message,name:e.path.join(`.`)})),result:null}:{errors:null,result:r}}async function I(e,t){try{return{errors:null,result:await t.validateAsync(e,{abortEarly:!1})}}catch(e){if(j(e))return{errors:e.details.map(e=>({name:e.path.join(`.`),message:e.message})),result:null};throw e}}function L(e,t){if(M(t))return N(e,t);if(A(t))return I(e,t);if(D(t))return P(e,t);if(k(t))return F(e,t);throw Error(`Form validation failed: Unsupported form schema`)}var R=class e extends Error{formId;errors;children;constructor(t,n,r){super(`Form validation exception`),this.formId=t,this.errors=n,this.children=r,Object.setPrototypeOf(this,e.prototype)}},z={__name:`UForm`,props:{id:{type:[String,Number],required:!1},schema:{type:null,required:!1},state:{type:Object,required:!0},validate:{type:Function,required:!1},validateOn:{type:Array,required:!1,default(){return[`input`,`blur`,`change`]}},disabled:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1,default:300},transform:{type:null,required:!1,default:()=>!0},attach:{type:Boolean,required:!1,default:!0},loadingAuto:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},onSubmit:{type:Function,required:!1}},emits:[`submit`,`error`],setup(D,{expose:O,emit:k}){let A=D,j=k,M=u(),N=S(()=>n({extend:n(E),...M.ui?.form||{}})),P=A.id??e(),F=g(`form-${P}`),I=A.attach&&r(d,void 0);c(d,F);let z=b(new Map);o(async()=>{F.on(async e=>{e.type===`attach`?z.value.set(e.formId,{validate:e.validate}):e.type===`detach`?z.value.delete(e.formId):A.validateOn?.includes(e.type)&&!Y.value&&(e.type===`input`?(e.eager||W.has(e.name))&&await J({name:e.name,silent:!0,nested:!1}):await J({name:e.name,silent:!0,nested:!1})),e.type===`blur`&&W.add(e.name),(e.type===`change`||e.type===`input`||e.type===`blur`||e.type===`focus`)&&U.add(e.name),(e.type===`change`||e.type===`input`)&&H.add(e.name)})}),m(()=>{F.reset()}),o(async()=>{I&&(await f(),I.emit({type:`attach`,validate:J,formId:P}))}),m(()=>{I&&I.emit({type:`detach`,formId:P})});let B=b([]);c(i,B);let V=b({});c(l,V);let H=_(new Set),U=_(new Set),W=_(new Set);function G(e){return e.map(e=>({...e,id:e?.name?V.value[e.name]?.id:void 0}))}let K=b(null);async function q(){let e=A.validate?await A.validate(A.state)??[]:[];if(A.schema){let{errors:t,result:n}=await L(A.state,A.schema);t?e=e.concat(t):K.value=n}return G(e)}async function J(e={silent:!1,nested:!0,transform:!1}){let t=e.name&&!Array.isArray(e.name)?[e.name]:e.name,n=!t&&e.nested?Array.from(z.value.values()).map(({validate:t})=>t(e).then(()=>void 0).catch(e=>{if(!(e instanceof R))throw e;return e})):[];if(t){let e=new Set(t),n=t.map(e=>V.value?.[e]?.pattern).filter(Boolean),r=t=>t.name?e.has(t.name)?!0:n.some(e=>e.test(t.name)):!1,i=await q(),a=B.value.filter(e=>!r(e)),o=i.filter(r);B.value=a.concat(o)}else B.value=await q();let r=(await Promise.all(n)).filter(e=>e!==void 0);if(B.value.length+r.length>0){if(e.silent)return!1;throw new R(P,B.value,r)}return e.transform&&Object.assign(A.state,K.value),A.state}let Y=b(!1);c(p,v(Y));async function X(e){Y.value=A.loadingAuto&&!0;let t=e;try{t.data=await J({nested:!0,transform:A.transform}),await A.onSubmit?.(t),H.clear()}catch(e){if(!(e instanceof R))throw e;let n={...t,errors:e.errors,children:e.children};j(`error`,n)}finally{Y.value=!1}}let Z=S(()=>A.disabled||Y.value);return c(T,S(()=>({disabled:Z.value,validateOnInputDelay:A.validateOnInputDelay}))),O({validate:J,errors:B,setErrors(e,t){t?B.value=B.value.filter(e=>t instanceof RegExp?!(e.name&&t.test(e.name)):e.name!==t).concat(G(e)):B.value=G(e)},async submit(){await X(new Event(`submit`))},getErrors(e){return e?B.value.filter(t=>e instanceof RegExp?t.name&&e.test(t.name):t.name===e):B.value},clear(e){e?B.value=B.value.filter(t=>e instanceof RegExp?!(t.name&&e.test(t.name)):t.name!==e):B.value=[]},disabled:Z,loading:Y,dirty:S(()=>!!H.size),dirtyFields:v(H),blurredFields:v(W),touchedFields:v(U)}),(e,n)=>(a(),t(h(w(I)?`div`:`form`),{id:w(P),class:C(N.value({class:A.class})),onSubmit:y(X,[`prevent`])},{default:x(()=>[s(e.$slots,`default`,{errors:B.value,loading:Y.value})]),_:3},40,[`id`,`class`]))}};export{z as t};
//# sourceMappingURL=_yWzY2av.js.map