import{t as e}from"./XrRa3LO0.js";import{t}from"./DesV42jm.js";import{$r as n,Ai as r,Ca as i,Cr as a,Dr as o,Ga as s,Ja as c,La as l,Ra as u,Xr as d,_o as f,bi as p,ha as m,ja as h,ji as g,ka as _,ki as v,li as y,ma as b,po as x,so as S,xa as C,xi as w,xr as T,yo as E}from"#entry";function D(t,n){let r=x(),i=(e,i)=>{if(n.multiple&&Array.isArray(t.value))if(n.selectionBehavior===`replace`)t.value=[e],r.value=e;else{let n=t.value.findIndex(e=>i(e));n===-1?t.value=[...t.value,e]:t.value=t.value.filter((e,t)=>t!==n)}else n.selectionBehavior===`replace`?t.value={...e}:!Array.isArray(t.value)&&i(t.value)?t.value=void 0:t.value={...e};return t.value};function a(i,a,o,s){if(!r?.value||!n.multiple||!Array.isArray(t.value))return;let c=o().filter(e=>e.ref.dataset.disabled!==``).find(e=>e.ref===a)?.value;if(!c)return;let l=null;switch(i){case`prev`:case`next`:l=e(s,r.value,c);break;case`first`:l=e(s,r.value,s?.[0]);break;case`last`:l=e(s,r.value,s?.[s.length-1]);break}t.value=l}return{firstValue:r,onSelectItem:i,handleMultipleReplace:a}}function O(e){return e.reduce((e,t)=>(e.push(t),t.children&&e.push(...O(t.children)),e),[])}var[k,A]=g(`TreeRoot`),j=h({__name:`TreeRoot`,props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},items:{type:Array,required:!1},expanded:{type:Array,required:!1},defaultExpanded:{type:Array,required:!1},getKey:{type:Function,required:!0},getChildren:{type:Function,required:!1,default:e=>e.children},selectionBehavior:{type:String,required:!1,default:`toggle`},multiple:{type:Boolean,required:!1,skipCheck:!0},dir:{type:String,required:!1},disabled:{type:Boolean,required:!1},propagateSelect:{type:Boolean,required:!1},bubbleSelect:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:`ul`}},emits:[`update:modelValue`,`update:expanded`],setup(e,{emit:t}){let o=e,l=t,{items:h,multiple:g,disabled:v,propagateSelect:k,dir:j,bubbleSelect:M}=f(o),{handleTypeaheadSearch:N}=n(),P=y(j),F=x(),I=x(!1),L=w(),R=p(o,`modelValue`,l,{defaultValue:o.defaultValue??(g.value?[]:void 0),passive:!0,deep:!0}),z=p(o,`expanded`,l,{defaultValue:o.defaultExpanded??[],passive:o.expanded===void 0,deep:!0}),{onSelectItem:B,handleMultipleReplace:V}=D(R,o),H=C(()=>g.value&&Array.isArray(R.value)?R.value.map(e=>o.getKey(e)):[o.getKey(R.value??{})]);function U(e,t=1,n){return e.reduce((r,i,a)=>{let s=o.getKey(i),c=o.getChildren(i),l=z.value.includes(s),u={_id:s,value:i,index:a,level:t,parentItem:n,hasChildren:!!c,bind:{value:i,level:t,"aria-setsize":e.length,"aria-posinset":a+1}};return r.push(u),c&&l&&r.push(...U(c,t+1,i)),r},[])}let W=C(()=>{let e=o.items;return z.value.map(e=>e),U(e??[])});function G(e){if(I.value)L.trigger(e);else{let t=F.value?.getItems()??[];N(e.key,t)}}function K(e){if(I.value)return;let t=a[e.key];u(()=>{V(t,r(),F.value?.getItems,W.value.map(e=>e.value))})}function q(e){if(e.parentItem!=null&&Array.isArray(R.value)&&o.multiple){let t=W.value.find(t=>e.parentItem!=null&&o.getKey(t.value)===o.getKey(e.parentItem));t!=null&&(o.getChildren(t.value)?.every(e=>R.value.find(t=>o.getKey(t)===o.getKey(e)))?R.value=[...R.value,t.value]:R.value=R.value.filter(e=>o.getKey(e)!==o.getKey(t.value)),q(t))}}return A({modelValue:R,selectedKeys:H,onSelect:e=>{let t=t=>o.getKey(t??{})===o.getKey(e),n=o.multiple&&Array.isArray(R.value)?R.value?.findIndex(t)!==-1:void 0;if(B(e,t),o.bubbleSelect&&o.multiple&&Array.isArray(R.value)){let t=W.value.find(t=>o.getKey(t.value)===o.getKey(e));t!=null&&q(t)}if(o.propagateSelect&&o.multiple&&Array.isArray(R.value)){let t=O(o.getChildren(e)??[]);n?R.value=[...R.value].filter(e=>!t.some(t=>o.getKey(e??{})===o.getKey(t))):R.value=[...R.value,...t]}},expanded:z,onToggle(e){if(!(e&&o.getChildren(e)))return;let t=o.getKey(e)??e;z.value.includes(t)?z.value=z.value.filter(e=>e!==t):z.value.push(t)},getKey:o.getKey,getChildren:o.getChildren,items:h,expandedItems:W,disabled:v,multiple:g,dir:P,propagateSelect:k,bubbleSelect:M,isVirtual:I,virtualKeydownHook:L,handleMultipleReplace:V}),(e,t)=>(s(),i(E(T),{ref_key:`rovingFocusGroupRef`,ref:F,"as-child":``,orientation:`vertical`,dir:E(P)},{default:S(()=>[_(E(d),{role:`tree`,as:e.as,"as-child":e.asChild,"aria-multiselectable":E(g)?!0:void 0,onKeydown:[G,b(m(K,[`shift`]),[`up`,`down`])]},{default:S(()=>[c(e.$slots,`default`,{flattenItems:W.value,modelValue:E(R),expanded:E(z)})]),_:3},8,[`as`,`as-child`,`aria-multiselectable`,`onKeydown`])]),_:3},8,[`dir`]))}}),M=`tree.select`,N=`tree.toggle`,P=h({inheritAttrs:!1,__name:`TreeItem`,props:{value:{type:null,required:!0},level:{type:Number,required:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:`li`}},emits:[`select`,`toggle`],setup(e,{expose:n,emit:a}){let u=e,f=a,p=k(),{getItems:h}=o(),g=C(()=>!!p.getChildren(u.value)),y=C(()=>{let e=p.getKey(u.value);return p.expanded.value.includes(e)}),x=C(()=>{let e=p.getKey(u.value);return p.selectedKeys.value.includes(e)}),w=C(()=>{if(p.bubbleSelect.value&&g.value&&Array.isArray(p.modelValue.value)){let e=O(p.getChildren(u.value)||[]);return e.some(e=>p.modelValue.value.find(t=>p.getKey(t)===p.getKey(e)))&&!e.every(e=>p.modelValue.value.find(t=>p.getKey(t)===p.getKey(e)))}else if(p.propagateSelect.value&&x.value&&g.value&&Array.isArray(p.modelValue.value))return!O(p.getChildren(u.value)||[]).every(e=>p.modelValue.value.find(t=>p.getKey(t)===p.getKey(e)));else return});function T(e){if(g.value)if(y.value){let e=h().map(e=>e.ref),t=r(),n=e.indexOf(t),i=[...e].slice(n).find(e=>Number(e.getAttribute(`data-indent`))===u.level+1);i&&i.focus()}else F(e)}function D(e){if(y.value)F(e);else{let e=h().map(e=>e.ref),t=r(),n=e.indexOf(t),i=[...e].slice(0,n).reverse().find(e=>Number(e.getAttribute(`data-indent`))===u.level-1);i&&i.focus()}}async function A(e){f(`select`,e),!e?.defaultPrevented&&p.onSelect(u.value)}async function j(e){f(`toggle`,e),!e?.defaultPrevented&&p.onToggle(u.value)}async function P(e){if(!e)return;let t={originalEvent:e,value:u.value,isExpanded:y.value,isSelected:x.value};v(M,A,t)}async function F(e){if(!e)return;let t={originalEvent:e,value:u.value,isExpanded:y.value,isSelected:x.value};v(N,j,t)}return n({isExpanded:y,isSelected:x,isIndeterminate:w,handleToggle:()=>p.onToggle(u.value),handleSelect:()=>p.onSelect(u.value)}),(e,n)=>(s(),i(E(t),{"as-child":``,value:e.value,"allow-shift-key":``},{default:S(()=>[_(E(d),l(e.$attrs,{role:`treeitem`,as:e.as,"as-child":e.asChild,"aria-selected":x.value,"aria-expanded":g.value?y.value:void 0,"aria-level":e.level,"data-indent":e.level,"data-selected":x.value?``:void 0,"data-expanded":y.value?``:void 0,onKeydown:[b(m(P,[`self`,`prevent`]),[`enter`,`space`]),n[0]||=b(m(e=>E(p).dir.value===`ltr`?T(e):D(e),[`prevent`]),[`right`]),n[1]||=b(m(e=>E(p).dir.value===`ltr`?D(e):T(e),[`prevent`]),[`left`])],onClick:n[2]||=m(e=>{P(e),F(e)},[`stop`])}),{default:S(()=>[c(e.$slots,`default`,{isExpanded:y.value,isSelected:x.value,isIndeterminate:w.value,handleSelect:()=>E(p).onSelect(e.value),handleToggle:()=>E(p).onToggle(e.value)})]),_:3},16,[`as`,`as-child`,`aria-selected`,`aria-expanded`,`aria-level`,`data-indent`,`data-selected`,`data-expanded`,`onKeydown`])]),_:3},8,[`value`]))}});export{j as n,P as t};
//# sourceMappingURL=D_nWdEbW.js.map