{"version":3,"file":"BP_6dyZB.js","names":["$attrs"],"sources":["../../node_modules/libs/nuip/dist/runtime/components/prose/CodeTree.vue"],"sourcesContent":["<script>\nimport theme from \"#build/ui-pro/prose/code-tree\";\n</script>\n\n<script setup>\nimport { computed, ref, watch, onBeforeUpdate } from \"vue\";\nimport { TreeRoot, TreeItem } from \"reka-ui\";\nimport { createReusableTemplate } from \"@vueuse/core\";\nimport UIcon from \"@nuxt/ui/components/Icon.vue\";\nimport { useAppConfig } from \"#imports\";\nimport { tv } from \"../../utils/tv\";\nimport UCodeIcon from \"./CodeIcon.vue\";\ndefineOptions({ inheritAttrs: false });\nconst props = defineProps({\n  defaultValue: { type: String, required: false },\n  expandAll: { type: Boolean, required: false },\n  class: { type: null, required: false },\n  ui: { type: null, required: false }\n});\nconst slots = defineSlots();\nconst appConfig = useAppConfig();\nconst [DefineTreeTemplate, ReuseTreeTemplate] = createReusableTemplate();\nconst ui = computed(() => tv({ extend: tv(theme), ...appConfig.uiPro?.prose?.codeTree || {} })());\nconst model = ref(props.defaultValue ? { path: props.defaultValue } : void 0);\nconst lastSelectedItem = ref();\nconst rerenderCount = ref(1);\nconst flatItems = computed(() => {\n  rerenderCount.value;\n  return slots.default?.()?.flatMap(transformSlot).filter(Boolean) || [];\n});\nconst items = computed(() => buildTree(flatItems.value));\nfunction buildTree(items2) {\n  const map = /* @__PURE__ */ new Map();\n  const root = [];\n  items2.forEach((item) => {\n    const parts = item.label.split(\"/\");\n    let path = \"\";\n    parts.forEach((part, i) => {\n      path = path ? `${path}/${part}` : part;\n      if (!map.has(path)) {\n        const node = { label: part, path, ...i < parts.length - 1 && { children: [] } };\n        map.set(path, node);\n        if (i === 0) {\n          root.push(node);\n        } else {\n          map.get(parts.slice(0, i).join(\"/\"))?.children?.push(node);\n        }\n      }\n    });\n  });\n  const sort = (nodes) => nodes.sort(\n    (a, b) => !!a.children === !!b.children ? a.label.localeCompare(b.label) : b.children ? 1 : -1\n  ).map((n) => ({ ...n, children: n.children && sort(n.children) }));\n  return sort(root);\n}\nfunction transformSlot(slot, index) {\n  if (typeof slot.type === \"symbol\") {\n    return slot.children?.map(transformSlot);\n  }\n  return {\n    label: slot.props?.filename || slot.props?.label || `${index}`,\n    icon: slot.props?.icon,\n    component: slot\n  };\n}\nconst expanded = computed(() => {\n  if (props.expandAll) {\n    const allPaths = /* @__PURE__ */ new Set();\n    flatItems.value.forEach((item) => {\n      const parts2 = item.label.split(\"/\");\n      for (let i = 1; i < parts2.length; i++) {\n        allPaths.add(parts2.slice(0, i).join(\"/\"));\n      }\n    });\n    return Array.from(allPaths);\n  }\n  const path = model.value?.path;\n  if (!path) {\n    return [];\n  }\n  const parts = path.split(\"/\");\n  return parts.map((_, index) => parts.slice(0, index + 1).join(\"/\"));\n});\nwatch(model, (value) => {\n  const item = flatItems.value.find((item2) => value?.path === item2.label);\n  if (item?.component) {\n    lastSelectedItem.value = item;\n  }\n}, { immediate: true });\nonBeforeUpdate(() => rerenderCount.value++);\n</script>\n\n<template>\n  <DefineTreeTemplate v-slot=\"{ items, level }\">\n    <li\n      v-for=\"(item, index) in items\"\n      :key=\"`${level}-${index}`\"\n      :class=\"level > 0 ? ui.itemWithChildren({ class: props.ui?.itemWithChildren }) : ui.item({ class: props.ui?.item })\"\n    >\n      <TreeItem\n        v-slot=\"{ isExpanded, isSelected }\"\n        as-child\n        :level=\"level\"\n        :value=\"item\"\n      >\n        <button :class=\"ui.link({ class: props.ui?.link, active: isSelected })\">\n          <UIcon\n            v-if=\"item.children?.length\"\n            :name=\"isExpanded ? appConfig.ui.icons.folderOpen : appConfig.ui.icons.folder\"\n            :class=\"ui.linkLeadingIcon({ class: props.ui?.linkLeadingIcon })\"\n          />\n          <UCodeIcon\n            v-else\n            :filename=\"item.label\"\n            :class=\"ui.linkLeadingIcon({ class: props.ui?.linkLeadingIcon })\"\n          />\n\n          <span :class=\"ui.linkLabel({ class: props.ui?.linkLabel })\">\n            {{ item.label }}\n          </span>\n\n          <span v-if=\"item.children?.length\" :class=\"ui.linkTrailing({ class: props.ui?.linkTrailing })\">\n            <UIcon :name=\"appConfig.ui.icons.chevronDown\" :class=\"ui.linkTrailingIcon({ class: props.ui?.linkTrailingIcon })\" />\n          </span>\n        </button>\n\n        <ul v-if=\"item.children?.length && isExpanded\" :class=\"ui.listWithChildren({ class: props.ui?.listWithChildren })\">\n          <ReuseTreeTemplate :items=\"item.children\" :level=\"level + 1\" />\n        </ul>\n      </TreeItem>\n    </li>\n  </DefineTreeTemplate>\n\n  <div v-bind=\"$attrs\" :class=\"ui.root({ class: [props.ui?.root, props.class] })\">\n    <TreeRoot\n      v-model=\"model\"\n      :class=\"ui.list({ class: props.ui?.list })\"\n      :items=\"items\"\n      :get-key=\"(item2) => item2.path\"\n      :default-expanded=\"expanded\"\n    >\n      <ReuseTreeTemplate :items=\"items\" :level=\"0\" />\n    </TreeRoot>\n\n    <div :class=\"ui.content({ class: props.ui?.content })\">\n      <component :is=\"lastSelectedItem?.component\" />\n    </div>\n  </div>\n</template>\n"],"mappings":"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"}