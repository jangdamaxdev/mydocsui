{"version":3,"file":"CfUAtmxC.js","names":[],"sources":["../../node_modules/libs/nuip/dist/runtime/components/ChatMessages.vue"],"sourcesContent":["<script>\nimport theme from \"#build/ui-pro/chat-messages\";\n</script>\n\n<script setup>\nimport { ref, computed, watch, nextTick, toRef, onMounted } from \"vue\";\nimport { Presence } from \"reka-ui\";\nimport { defu } from \"defu\";\nimport { useElementBounding, useEventListener, watchThrottled } from \"@vueuse/core\";\nimport UButton from \"@nuxt/ui/components/Button.vue\";\nimport { omit } from \"@nuxt/ui/utils\";\nimport { useAppConfig } from \"#imports\";\nimport { tv } from \"../utils/tv\";\nimport UChatMessage from \"./ChatMessage.vue\";\nconst props = defineProps({\n  messages: { type: Array, required: false },\n  status: { type: null, required: false },\n  shouldAutoScroll: { type: Boolean, required: false, default: false },\n  shouldScrollToBottom: { type: Boolean, required: false, default: true },\n  autoScroll: { type: [Boolean, Object], required: false, default: true },\n  autoScrollIcon: { type: String, required: false },\n  user: { type: Object, required: false },\n  assistant: { type: Object, required: false },\n  compact: { type: Boolean, required: false },\n  spacingOffset: { type: Number, required: false, default: 0 },\n  class: { type: null, required: false },\n  ui: { type: null, required: false }\n});\nconst slots = defineSlots();\nconst proxySlots = omit(slots, [\"default\", \"indicator\", \"viewport\"]);\nconst appConfig = useAppConfig();\nconst userProps = toRef(() => defu(props.user, { side: \"right\", variant: \"soft\" }));\nconst assistantProps = toRef(() => defu(props.assistant, { side: \"left\", variant: \"naked\" }));\nconst ui = computed(() => tv({ extend: tv(theme), ...appConfig.uiPro?.chatMessages || {} })({\n  compact: props.compact\n}));\nconst el = ref(null);\nconst parent = ref(null);\nconst messagesRefs = ref(/* @__PURE__ */ new Map());\nconst showAutoScroll = ref(false);\nconst lastMessageHeight = ref(0);\nconst lastMessageSubmitted = ref(false);\nfunction registerMessageRef(id, element) {\n  const elInstance = element?.$el;\n  if (elInstance) {\n    messagesRefs.value.set(id, elInstance);\n  }\n}\nfunction scrollToMessage(id) {\n  const element = messagesRefs.value.get(id);\n  if (element) {\n    element.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n  }\n}\nfunction scrollToBottom(smooth = true) {\n  if (!parent.value) {\n    return;\n  }\n  if (smooth) {\n    parent.value.scrollTo({ top: parent.value.scrollHeight, behavior: \"smooth\" });\n  } else {\n    parent.value.scrollTop = parent.value.scrollHeight;\n  }\n}\nwatchThrottled([() => props.messages, () => props.status], ([_, status]) => {\n  if (status !== \"streaming\") {\n    return;\n  }\n  if (props.shouldAutoScroll) {\n    requestAnimationFrame(() => nextTick(scrollToBottom));\n  } else {\n    checkScrollPosition();\n  }\n}, { throttle: 100, leading: true });\nwatch(() => props.status, (status) => {\n  if (status !== \"submitted\") {\n    return;\n  }\n  const lastMessage = props.messages?.[props.messages.length - 1];\n  if (!lastMessage || lastMessage.role !== \"user\") {\n    return;\n  }\n  nextTick(() => {\n    lastMessageSubmitted.value = true;\n    updateLastMessageHeight();\n    nextTick(() => {\n      scrollToMessage(lastMessage.id);\n    });\n  });\n});\nfunction checkScrollPosition() {\n  if (!parent.value) {\n    return;\n  }\n  const scrollPosition = parent.value.scrollTop + parent.value.clientHeight;\n  const scrollHeight = parent.value.scrollHeight;\n  const threshold = 100;\n  showAutoScroll.value = scrollHeight - scrollPosition >= threshold;\n}\nfunction onAutoScrollClick() {\n  scrollToBottom();\n}\nfunction getScrollParent(node) {\n  if (!node) {\n    return document.documentElement;\n  }\n  const overflowRegex = /auto|scroll/;\n  let current = node;\n  while (current && current !== document.body && current !== document.documentElement) {\n    const style = window.getComputedStyle(current);\n    if (overflowRegex.test(style.overflowY)) {\n      return current;\n    }\n    current = current.parentElement;\n  }\n  return document.documentElement;\n}\nfunction updateLastMessageHeight() {\n  if (!el.value || !parent.value || !props.messages?.length || !lastMessageSubmitted.value) {\n    return;\n  }\n  const { height: parentHeight } = useElementBounding(parent.value);\n  const lastMessage = props.messages.findLast((m) => m.role === \"user\");\n  if (!lastMessage) {\n    return;\n  }\n  const lastMessageEl = messagesRefs.value.get(lastMessage.id);\n  if (!lastMessageEl) {\n    return;\n  }\n  let spacingOffset = props.spacingOffset || 0;\n  const elComputedStyle = window.getComputedStyle(el.value);\n  const parentComputedStyle = window.getComputedStyle(parent.value);\n  spacingOffset += Number.parseFloat(elComputedStyle.rowGap) || Number.parseFloat(elComputedStyle.gap) || 0;\n  spacingOffset += Number.parseFloat(parentComputedStyle.paddingTop) || 0;\n  spacingOffset += Number.parseFloat(parentComputedStyle.paddingBottom) || 0;\n  lastMessageHeight.value = Math.max(parentHeight.value - lastMessageEl.offsetHeight - spacingOffset, 0);\n}\nonMounted(() => {\n  parent.value = getScrollParent(el.value);\n  if (!parent.value) {\n    return;\n  }\n  if (props.shouldScrollToBottom) {\n    nextTick(() => scrollToBottom(false));\n  } else {\n    checkScrollPosition();\n  }\n  useEventListener(parent, \"scroll\", checkScrollPosition);\n  useEventListener(window, \"resize\", () => nextTick(updateLastMessageHeight));\n});\n</script>\n\n<template>\n  <div\n    ref=\"el\"\n    :data-status=\"status\"\n    :class=\"ui.root({ class: [props.ui?.root, props.class] })\"\n    :style=\"{ '--last-message-height': `${lastMessageHeight}px` }\"\n  >\n    <slot>\n      <UChatMessage\n        v-for=\"message in messages\"\n        :key=\"message.id\"\n        v-bind=\"{ ...message, ...message.role === 'user' ? userProps : assistantProps }\"\n        :ref=\"(el) => registerMessageRef(message.id, el)\"\n        :compact=\"compact\"\n      >\n        <template v-for=\"(_, name) in proxySlots\" #[name]>\n          <slot :name=\"name\" v-bind=\"{ message }\" />\n        </template>\n      </UChatMessage>\n    </slot>\n\n    <UChatMessage\n      v-if=\"status === 'submitted'\"\n      id=\"indicator\"\n      content=\"\"\n      role=\"assistant\"\n      v-bind=\"{ ...assistantProps, actions: void 0 }\"\n      :compact=\"compact\"\n    >\n      <template #content>\n        <div :class=\"ui.indicator({ class: props.ui?.indicator })\">\n          <slot name=\"indicator\">\n            <span />\n            <span />\n            <span />\n          </slot>\n        </div>\n      </template>\n    </UChatMessage>\n\n    <Presence :present=\"showAutoScroll\">\n      <div :data-state=\"showAutoScroll ? 'open' : 'closed'\" :class=\"ui.viewport({ class: props.ui?.viewport })\">\n        <slot name=\"viewport\" :on-click=\"onAutoScrollClick\">\n          <UButton\n            v-if=\"autoScroll\"\n            :icon=\"autoScrollIcon || appConfig.ui.icons.arrowDown\"\n            color=\"neutral\"\n            variant=\"outline\"\n            v-bind=\"typeof autoScroll === 'object' ? autoScroll : {}\"\n            :class=\"ui.autoScroll({ class: props.ui?.autoScroll })\"\n            @click=\"onAutoScrollClick\"\n          />\n        </slot>\n      </div>\n    </Presence>\n  </div>\n</template>\n"],"mappings":"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"}